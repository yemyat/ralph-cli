{
  "version": 1,
  "updatedAt": "2026-01-17T14:28:13.911Z",
  "updatedBy": "build-mode",
  "specs": [
    {
      "id": "configurable-quality-gates",
      "file": "specs/014-configurable-quality-gates.md",
      "name": "Configurable Quality Gates",
      "priority": 1,
      "status": "pending",
      "context": "Add qualityGates array to implementation.json root so teams can define project-specific build verification commands. Affects: src/types.ts (Implementation interface), src/utils/quality-gates.ts (parseQualityGates utility), src/utils/implementation.ts (createEmptyImplementation template), build mode task verification. Remove DEFAULT_QUALITY_GATES constant - no hardcoded defaults.",
      "tasks": [
        {
          "id": "configurable-quality-gates-1",
          "description": "Update `Implementation` interface in `src/types.ts` to include optional `qualityGates?: string[]`",
          "status": "pending",
          "acceptanceCriteria": [
            "Implementation interface has optional qualityGates property typed as string[]"
          ]
        },
        {
          "id": "configurable-quality-gates-2",
          "description": "Create `parseQualityGates(commands: string[]): QualityGate[]` utility in `src/utils/quality-gates.ts`",
          "status": "pending",
          "acceptanceCriteria": [
            "Function converts string array to QualityGate[] objects",
            "Gate name is extracted from last word of command (e.g., 'bun run typecheck' â†’ 'typecheck')",
            "All gates are marked as required: true"
          ]
        },
        {
          "id": "configurable-quality-gates-3",
          "description": "Update build mode to read gates from implementation.json (skip if not defined)",
          "status": "pending",
          "acceptanceCriteria": [
            "Build mode reads qualityGates from implementation.json",
            "If qualityGates is undefined or empty, quality gate verification is skipped"
          ]
        },
        {
          "id": "configurable-quality-gates-4",
          "description": "Update `createEmptyImplementation()` in `src/utils/implementation.ts` to include sample `qualityGates` array",
          "status": "pending",
          "acceptanceCriteria": [
            "Template includes sample qualityGates array with common commands",
            "ralph init creates implementation.json with sample gates"
          ]
        },
        {
          "id": "configurable-quality-gates-5",
          "description": "Remove or deprecate `DEFAULT_QUALITY_GATES` constant",
          "status": "pending",
          "acceptanceCriteria": [
            "DEFAULT_QUALITY_GATES constant is removed or marked deprecated",
            "No hardcoded quality gate defaults remain"
          ]
        },
        {
          "id": "configurable-quality-gates-6",
          "description": "Add unit tests for `parseQualityGates`",
          "status": "pending",
          "acceptanceCriteria": [
            "Test: parseQualityGates converts string array to QualityGate[]",
            "Test: Empty array results in empty QualityGate[]",
            "Test: Gate name extraction works for various command formats"
          ]
        }
      ],
      "acceptanceCriteria": [
        "Given implementation.json has qualityGates array, when build mode runs, then those commands are used for verification",
        "Given implementation.json has no qualityGates key, when build mode runs, then quality gate verification is skipped",
        "Given a quality gate command fails, when verifying a task, then the task is marked as failed",
        "Given ralph init is run, when implementation.json is created, then it contains sample qualityGates array"
      ]
    },
    {
      "id": "task-level-build-loop-integration-test",
      "file": "specs/013-task-level-build-loop-integration-test.md",
      "name": "Task-Level Build Loop Integration Test",
      "priority": 3,
      "status": "completed",
      "context": "Spec requires integration tests for task-level orchestration in build mode. Should extend existing e2e-loop.test.ts pattern (src/__tests__/e2e-loop.test.ts) with mock agent that captures prompts to temp files. Tests verify task isolation (agent gets one task, not full spec) and retry context injection. Existing infrastructure: task-prompts.ts (generateTaskPrompt, generateRetryPrompt), implementation.ts (task state management), quality-gates.ts (runQualityGates), start.ts (runTaskLevelLoop at line 511).",
      "tasks": [
        {
          "id": "task-level-build-loop-integration-test-1",
          "description": "Create mock agent script that captures received prompt to temp file and outputs configurable markers",
          "status": "completed",
          "acceptanceCriteria": [
            "Mock script writes prompt to temp file for assertions",
            "Mock script outputs <TASK_DONE> or <TASK_BLOCKED> based on env var",
            "Mock script is executable and works with bun"
          ],
          "completedAt": "2026-01-17T14:11:54.912Z"
        },
        {
          "id": "task-level-build-loop-integration-test-2",
          "description": "Create mock quality gate script with configurable exit codes via env var",
          "status": "completed",
          "acceptanceCriteria": [
            "Script returns exit code based on MOCK_GATE_EXIT_CODE env var",
            "Script outputs mock failure messages when exit code is non-zero"
          ],
          "completedAt": "2026-01-17T14:13:15.582Z"
        },
        {
          "id": "task-level-build-loop-integration-test-3",
          "description": "Write test: 3 tasks spawn 3 separate sessions with isolated prompts",
          "status": "completed",
          "acceptanceCriteria": [
            "Given spec with 3 tasks, when build loop runs, then 3 separate agent sessions are spawned",
            "Each captured prompt file contains only its corresponding task description"
          ],
          "completedAt": "2026-01-17T14:18:16.041Z"
        },
        {
          "id": "task-level-build-loop-integration-test-4",
          "description": "Write test: captured prompt contains ONLY current task, not other tasks",
          "status": "completed",
          "acceptanceCriteria": [
            "Given task 2 of 3, when agent is spawned, then prompt contains ONLY task 2 description",
            "Prompt does not contain task 1 or task 3 descriptions"
          ],
          "retryCount": 1,
          "completedAt": "2026-01-17T14:22:21.517Z"
        },
        {
          "id": "task-level-build-loop-integration-test-5",
          "description": "Write test: quality gate failure triggers retry with failure output in prompt",
          "status": "completed",
          "acceptanceCriteria": [
            "Given quality gates fail with 'typecheck: error TS123', when retry spawns, then prompt includes 'typecheck: error TS123'"
          ],
          "completedAt": "2026-01-17T14:24:27.687Z"
        },
        {
          "id": "task-level-build-loop-integration-test-6",
          "description": "Write test: implementation.json task status updates to completed after success",
          "status": "completed",
          "acceptanceCriteria": [
            "Given all 3 tasks complete successfully, when build loop finishes, then all 3 tasks show status 'completed' in implementation.json"
          ],
          "completedAt": "2026-01-17T14:26:05.664Z"
        },
        {
          "id": "task-level-build-loop-integration-test-7",
          "description": "Write test: blocked task gets marked with reason from TASK_BLOCKED marker",
          "status": "completed",
          "acceptanceCriteria": [
            "Given agent outputs '<TASK_BLOCKED reason=\"missing API key\">', when build loop processes, then task status is 'blocked' with blockedReason 'missing API key'"
          ],
          "completedAt": "2026-01-17T14:28:13.911Z"
        }
      ],
      "acceptanceCriteria": [
        "Test proves task isolation (agent never sees full spec, only current task)",
        "Test proves retry includes failure context",
        "CI passes with mocked agent tests (no real AI calls)",
        "Tests run without network/AI dependencies",
        "Tests follow pattern from existing e2e-loop.test.ts"
      ]
    }
  ]
}
